<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Cookbook: java_se
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "chef::java_se";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (j)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../chef.html" title="chef (chef)">chef</a></span></span>
     &raquo; 
    <span class="title">java_se</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="cookbooks_list_link"
        href="../cookbooks_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="../class_list.html"></iframe>

      <div id="content">

<div id="filecontents">
  <h1>Cookbook : java_se</h1>
  

<h1>Java SE Cookbook</h1>

<p><a href="https://supermarket.chef.io/cookbooks/java_se"><img src="http://img.shields.io/cookbook/v/java_se.svg?style=flat-square" alt="Cookbook Version"></a>
<a href="https://travis-ci.org/dhoer/chef-java_se"><img src="http://img.shields.io/travis/dhoer/chef-java_se/master.svg?label=linux&amp;style=flat-square" alt="linux"></a>
<a href="https://travis-ci.org/dhoer/chef-java_se/branches"><img src="http://img.shields.io/travis/dhoer/chef-java_se/macosx.svg?label=macosx&amp;style=flat-square" alt="osx"></a>
<a href="https://ci.appveyor.com/project/dhoer/chef-java-se"><img src="https://img.shields.io/appveyor/ci/dhoer/chef-java-se/master.svg?label=windows&amp;style=flat-square" alt="win"></a></p>

<p>Installs Oracle&#39;s Java SE JDK version
<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">8u102</a>.</p>

<p>The next <a href="http://www.oracle.com/technetwork/topics/security/alerts-086861.html">scheduled</a> critical patch update:</p>

<ul>
<li>18 October 2016</li>
</ul>

<p>How is this different from <a href="https://github.com/agileorbit-cookbooks/java">Java</a> cookbook?</p>

<ul>
<li>Only supports Oracle&#39;s Java SE JDK </li>
<li>Oracle JDK versions are tied to java_se cookbook versions e.g., java_se 8.77.x is bound to JDK 8u77</li>
<li>Checksums are included in java_se cookbook and should not be overridden</li>
<li>Downloads directly from Oracle on all supported platforms</li>
<li>Can specify an alternative URI directory to download from e.g., <a href="https://s3.amazonaws.com/mybucket/java">https://s3.amazonaws.com/mybucket/java</a></li>
<li>Lightweight, no cookbook dependencies</li>
<li>Can globally skip Java installation</li>
<li>Only supports Linux (.tar.gz), Mac OS X (.dmg), and Windows (.exe) file extensions</li>
</ul>

<h2>Requirements</h2>

<ul>
<li>Chef 11+</li>
</ul>

<h3>Platforms</h3>

<ul>
<li>CentOS, Red Hat, Fedora</li>
<li>Debian, Ubuntu</li>
<li>Mac OS X</li>
<li>Windows</li>
</ul>

<h2>Usage</h2>

<p>By adding java_se to a run list (recipe[java_se]) or a cookbook (include_recipe &#39;java_se&#39;) you are accepting the
<a href="http://www.oracle.com/technetwork/java/javase/terms/license/index.html">Oracle Binary Code License Agreement for Java SE</a>. </p>

<p>It is recommended that you <a href="https://docs.chef.io/cookbook_versions.html#constraints">constrain</a> java_se cookbook 
version to a release e.g. &#39;~&gt; 8.0&#39; or an update e.g. &#39;~&gt; 8.77.0&#39; in your metadata.rb cookbook or 
<a href="https://docs.chef.io/cookbook_versions.html#environments">environment</a>. By default, the latest Oracle SE JDK is 
installed. </p>

<p>Windows JAVA_HOME and PATH environment variables are not available during initial chef-client run. Attribute
<code>node[&#39;java_se&#39;][&#39;win_javalink&#39;]</code> provides a symbolic link to installed Java JDK bin directory and is available
during initial chef-client run.</p>

<h3>Examples</h3>

<h4>Constrain java_se cookbook in metadata.rb</h4>

<p><code>depends &#39;java_se&#39;, &#39;~&gt; 8.0&#39;</code></p>

<p>Constrains install to latest available Java SE JDK 8.</p>

<h4>Constrain java_se cookbook in environment to a specific update</h4>

<p><code>cookbook &#39;java_se&#39;, &#39;~&gt; 8.77.0&#39;</code></p>

<p>Constrains install to Java SE JDK 8u77.</p>

<h4>Download JDK from alternative location</h4>

<pre class="code ruby"><code class="ruby">override_attributes(
  &quot;java_se&quot;: {
    &quot;uri&quot;: &quot;https://s3.amazonaws.com/mybucket/java&quot;
  }
)
</code></pre>

<p>This will download the JDK that best matches platform criteria e.g., Windows 64-bit with force_i586 flag set to true
will match <a href="https://s3.amazonaws.com/mybucket/java/jdk-8u77-windows-i586.exe">https://s3.amazonaws.com/mybucket/java/jdk-8u77-windows-i586.exe</a>. Note that JDK file names must be the
same as that found on Oracle&#39;s download page.</p>

<p>A script to download JDKs from Oracle and upload them to Amazon S3 is
available <a href="https://github.com/dhoer/chef-java_se/wiki/Populate-S3-with-JDKs">here</a>.</p>

<h3>Attributes</h3>

<ul>
<li><code>node[&#39;java_se&#39;][&#39;uri&#39;]</code> - The URI to the Java SE JDKs. If a directory is provided, it will then automatically
assign a file name that best matches platform criteria.  The JDK file names must be the same as that found on
Oracle&#39;s download page. Leave nil to download directly from Oracle. Default <code>nil</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;skip&#39;]</code> - Skips installing Java SE. Default <code>false</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;force_i586&#39;]</code> - Install i586 Java on x64 machine if true. For Linux and Windows
only. Default <code>false</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;java_home&#39;]</code> - Alternative java_home location. Leave nil to use default location. For Linux
and Windows only. Default <code>nil</code>.</li>
</ul>

<h4>Linux Only</h4>

<ul>
<li><code>node[&#39;java_se&#39;][&#39;set_default&#39;]</code> - Indicates whether or not you want the JDK installed to be default on the
system. Default <code>true</code>.<br></li>
<li><code>node[&#39;java_se&#39;][&#39;owner&#39;]</code> - The owner of extracted directory. Default <code>root</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;group&#39;]</code> - The group of extracted directory. Default <code>root</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;alternatives_priority&#39;]</code> - A priority of the alternatives. Default <code>1061</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;set_etc_environment&#39;]</code> - Optionally sets JAVA_HOME in /etc/environment for. Default <code>false</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;reset_alternatives&#39;]</code> - Whether alternatives is reset. Default <code>true</code>.<br></li>
<li><code>node[&#39;java_se&#39;][&#39;use_alt_suffix&#39;]</code> whether &#39;_alt&#39; suffix is used for none default java install. Default <code>false</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;bin_cmds&#39;]</code> -  Array of binary commands to symlink /usr/bin to, and set alternative on.  Examples
are mvn, java, javac, etc. These cmds must be in the bin subdirectory of the extracted folder. Will be ignored if
set_default is not true.</li>
</ul>

<h4>Windows Only</h4>

<ul>
<li><code>node[&#39;java_se&#39;][&#39;win_addlocal&#39;]</code> - JDK features to install. Default <code>ToolsFeature,SourceFeature,PublicjreFeature</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;win_javalink&#39;]</code> - Symbolic link to Java JDK bin directory. Since Windows PATH and JAVA_HOME
are not available during chef-client run, this provides a way for cookbooks to access the latest installed
version. Default <code>%SYSTEMDRIVE%\java\bin</code>.</li>
<li><code>node[&#39;java_se&#39;][&#39;win_jre_home&#39;]</code> - Location to install public JRE. Leave nil to use default location. Default <code>nil</code>.</li>
</ul>

<h4>Bind (Do not override)</h4>

<ul>
<li><code>node[&#39;java_se&#39;][&#39;release&#39;]</code> - The JDK release version.</li>
<li><code>node[&#39;java_se&#39;][&#39;update&#39;]</code> - The JDK update version.</li>
<li><code>node[&#39;java_se&#39;][&#39;build&#39;]</code> - The build number.</li>
<li><code>node[&#39;java_se&#39;][&#39;sha256&#39;][type][arch]</code> - The checksum to validate the installer with. Where <code>type</code> is one of &#39;dmg&#39;, 
&#39;exe&#39;, or &#39;tar&#39;, and <code>arch</code> is one of &#39;x64&#39; or &#39;i586&#39;</li>
</ul>

<h2>Versioning</h2>

<p>This cookbook does NOT use <a href="http://semver.org">SemVer</a> for versioning.  </p>

<p>The versioning scheme is RELEASE.UPDATE.MINOR where:</p>

<ol>
<li>RELEASE is the release of Java e.g. 8</li>
<li>UPDATE is the Java update e.g. 77</li>
<li>MINOR is the *cookbook release for an enhancement or bugfix e.g. 0</li>
</ol>

<p>*All MINOR versions will strive to be backwards-compatible.</p>

<h2>Getting Help</h2>

<ul>
<li>Ask specific questions on <a href="http://stackoverflow.com/questions/tagged/chef-java_se">Stack Overflow</a>.</li>
<li>Report bugs and discuss potential features in
<a href="https://github.com/dhoer/chef-java_se/issues">Github issues</a>.</li>
</ul>

<h2>Contributing</h2>

<p>Please refer to <a href="https://github.com/dhoer/chef-java_se/blob/master/CONTRIBUTING.md">CONTRIBUTING</a>.</p>

<h2>License</h2>

<p>MIT - see the accompanying <a href="https://github.com/dhoer/chef-java_se/blob/master/LICENSE.md">LICENSE</a> file
for details.</p>



<h1>Cookbook Documentation</h1>




  <h2>Recipes Summary</h2>
  <ul class="summary">
    
      <li>
        <span class="summary_signature">
          <strong><a href="#java_se::default">java_se::default</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#java_se::_linux_install">java_se::_linux_install</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#java_se::_macosx_install">java_se::_macosx_install</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
      <li>
        <span class="summary_signature">
          <strong><a href="#java_se::_windows_install">java_se::_windows_install</a></strong>
        </span>
        <span class="summary_desc"></span>
      </li>
    
  </ul>


















  <h2>Libraries</h2>
  <ul class="summary compact">
    
      <li><span class="summary_signature">
        <a href="../JavaSE/Downloader.html">JavaSE::Downloader</a>
      </li>
    
  </ul>



<div class="method_details_list">
  



  <h2>Recipe Details</h2>
  
    <div class="method_details first">
      <h3 class="signature"><a name="java_se::default">
        <strong>java_se::default</strong>
      </a></h3>
      
      

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1
2
3
4
5
6
7
8
9
10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'java_se/recipes/default.rb', line 1</span>

<span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>skip</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Skipping install of Java SE!</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>else</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>platform_family</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>mac_os_x</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_include_recipe'>include_recipe</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se::_macosx_install</span><span class='tstring_end'>'</span></span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>windows</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_include_recipe'>include_recipe</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se::_windows_install</span><span class='tstring_end'>'</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_include_recipe'>include_recipe</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se::_linux_install</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

    </div>
  
    <div class="method_details ">
      <h3 class="signature"><a name="java_se::_linux_install">
        <strong>java_se::_linux_install</strong>
      </a></h3>
      
      

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'java_se/recipes/_linux_install.rb', line 1</span>

<span class='comment'># inspiration from https://github.com/agileorbit-cookbooks/java
</span><span class='id identifier rubyid_file_cache_path'>file_cache_path</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_java_installer'>fetch_java_installer</span>

<span class='id identifier rubyid_bin_cmds'>bin_cmds</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>bin_cmds</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_default'>default</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>set_default</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_priority'>priority</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>alternatives_priority</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_owner'>owner</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>owner</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_group'>group</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>group</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_java_home'>java_home</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_home</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_java_home'>java_home</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/usr/lib/jvm/java</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_java_home'>java_home</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_java_home'>java_home</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

<span class='id identifier rubyid_ruby_block'>ruby_block</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>set-env-java-home</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_block'>block</span> <span class='kw'>do</span>
    <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>JAVA_HOME</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_java_home'>java_home</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_not_if'>not_if</span> <span class='lbrace'>{</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>JAVA_HOME</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='id identifier rubyid_java_home'>java_home</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_directory'>directory</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/etc/profile.d</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_mode'>mode</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>0755</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_file'>file</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/etc/profile.d/jdk.sh</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_content'>content</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>export JAVA_HOME=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_mode'>mode</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>0755</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_ruby_block'>ruby_block</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>set JAVA_HOME in /etc/environment</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_block'>block</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_file'>file</span> <span class='op'>=</span> <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>FileEdit</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/etc/environment</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_insert_line_if_no_match'>insert_line_if_no_match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^JAVA_HOME=</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JAVA_HOME=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_search_file_replace_line'>search_file_replace_line</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^JAVA_HOME=</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JAVA_HOME=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_file'>file</span><span class='period'>.</span><span class='id identifier rubyid_write_file'>write_file</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>set_etc_environment</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_yum_package'>yum_package</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>glibc</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_arch'>arch</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>i686</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_platform_family?'>platform_family?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rhel</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>fedora</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_java_arch'>java_arch</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>i586</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_package'>package</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tar</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_java_dir_name'>java_dir_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>jdk</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_version'>java_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_java_root'>java_root</span> <span class='op'>=</span> <span class='id identifier rubyid_java_home'>java_home</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_java_dir'>java_dir</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_root'>java_root</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_dir_name'>java_dir_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

<span class='kw'>if</span> <span class='id identifier rubyid_default'>default</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>use_alt_suffix</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>processing alternate jdk</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_java_dir'>java_dir</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_dir'>java_dir</span><span class='rbrace'>}</span><span class='tstring_content'>_alt</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_java_home'>java_home</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_content'>_alt</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_ruby_block'>ruby_block</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adding java to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_dir'>java_dir</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='comment'># ~FC014
</span>  <span class='id identifier rubyid_block'>block</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>fileutils</span><span class='tstring_end'>'</span></span>

    <span class='kw'>unless</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_java_root'>java_root</span><span class='rparen'>)</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_mkdir'>mkdir</span> <span class='id identifier rubyid_java_root'>java_root</span><span class='comma'>,</span> <span class='label'>mode:</span> <span class='int'>0o755</span>
      <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_chown'>chown</span> <span class='id identifier rubyid_owner'>owner</span><span class='comma'>,</span> <span class='id identifier rubyid_group'>group</span><span class='comma'>,</span> <span class='id identifier rubyid_java_root'>java_root</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_extract'>extract</span> <span class='op'>=</span> <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'> tar xvzf &quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file_cache_path'>file_cache_path</span><span class='rbrace'>}</span><span class='tstring_content'>&quot; -C &quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Chef</span><span class='op'>::</span><span class='const'>Config</span><span class='lbracket'>[</span><span class='symbol'>:file_cache_path</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>&quot; --no-same-owner</span><span class='tstring_end'>)</span></span>
    <span class='rparen'>)</span>
    <span class='id identifier rubyid_extract'>extract</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
    <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to extract file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tarball_name'>tarball_name</span><span class='rbrace'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_extract'>extract</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>

    <span class='id identifier rubyid_move'>move</span> <span class='op'>=</span> <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'> mv &quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Chef</span><span class='op'>::</span><span class='const'>Config</span><span class='lbracket'>[</span><span class='symbol'>:file_cache_path</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_dir_name'>java_dir_name</span><span class='rbrace'>}</span><span class='tstring_content'>&quot; &quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_dir'>java_dir</span><span class='rbrace'>}</span><span class='tstring_content'>&quot; </span><span class='tstring_end'>)</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_move'>move</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_move'>move</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
      <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>%(</span><span class='tstring_content'> Command \' mv &quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Chef</span><span class='op'>::</span><span class='const'>Config</span><span class='lbracket'>[</span><span class='symbol'>:file_cache_path</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_dir_name'>java_dir_name</span><span class='rbrace'>}</span><span class='tstring_content'>&quot; &quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_dir'>java_dir</span><span class='rbrace'>}</span><span class='tstring_content'>&quot; \' failed </span><span class='tstring_end'>)</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># change ownership of extracted files
</span>    <span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_chown_R'>chown_R</span> <span class='id identifier rubyid_owner'>owner</span><span class='comma'>,</span> <span class='id identifier rubyid_group'>group</span><span class='comma'>,</span> <span class='id identifier rubyid_java_root'>java_root</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_not_if'>not_if</span> <span class='lbrace'>{</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_java_dir'>java_dir</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='comment'># set up .jinfo file for update-java-alternatives
</span><span class='id identifier rubyid_java_name'>java_name</span> <span class='op'>=</span>  <span class='id identifier rubyid_java_home'>java_home</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_jinfo_file'>jinfo_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_root'>java_root</span><span class='rbrace'>}</span><span class='tstring_content'>/.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_name'>java_name</span><span class='rbrace'>}</span><span class='tstring_content'>.jinfo</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_template'>template</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adding </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_jinfo_file'>jinfo_file</span><span class='rbrace'>}</span><span class='tstring_content'> for debian</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_path'>path</span> <span class='id identifier rubyid_jinfo_file'>jinfo_file</span>
  <span class='id identifier rubyid_cookbook'>cookbook</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_source'>source</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>oracle.jinfo.erb</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_owner'>owner</span> <span class='id identifier rubyid_owner'>owner</span>
  <span class='id identifier rubyid_group'>group</span> <span class='id identifier rubyid_group'>group</span>
  <span class='id identifier rubyid_variables'>variables</span><span class='lparen'>(</span>
    <span class='label'>priority:</span> <span class='id identifier rubyid_priority'>priority</span><span class='comma'>,</span>
    <span class='label'>bin_cmds:</span> <span class='id identifier rubyid_bin_cmds'>bin_cmds</span><span class='comma'>,</span>
    <span class='label'>name:</span> <span class='id identifier rubyid_java_name'>java_name</span><span class='comma'>,</span>
    <span class='label'>java_dir:</span> <span class='id identifier rubyid_java_home'>java_home</span>
  <span class='rparen'>)</span>
  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:create</span>
  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_platform_family?'>platform_family?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>debian</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_jinfo_file'>jinfo_file</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_java_home'>java_home</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_java_dir'>java_dir</span>
<span class='kw'>end</span>

<span class='comment'># rubocop:disable  Style/Next
</span><span class='id identifier rubyid_ruby_block'>ruby_block</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>update-alternatives</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='comment'># ~FC014
</span>  <span class='id identifier rubyid_block'>block</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>platform_family</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rhel</span><span class='tstring_end'>'</span></span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>alternatives</span><span class='tstring_end'>'</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>update-alternatives</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_bin_cmds'>bin_cmds</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='op'>|</span>
      <span class='id identifier rubyid_bin_path'>bin_path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/bin/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_alt_path'>alt_path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_content'>/bin/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

      <span class='kw'>unless</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rparen'>)</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>skipping setting alternative for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'>. Command </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_content'> does not exist.</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>next</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_same_prio'>same_prio</span> <span class='op'>=</span> <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --display </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> | grep </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_content'> | grep 'priority </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_priority'>priority</span><span class='rbrace'>}</span><span class='tstring_content'>$'</span><span class='tstring_end'>&quot;</span></span>
      <span class='rparen'>)</span>
      <span class='id identifier rubyid_same_prio'>same_prio</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
      <span class='id identifier rubyid_alternative_exists_same_prio'>alternative_exists_same_prio</span> <span class='op'>=</span> <span class='id identifier rubyid_same_prio'>same_prio</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
      <span class='id identifier rubyid_alt_exists'>alt_exists</span> <span class='op'>=</span> <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --display </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> | grep </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_alt_exists'>alt_exists</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
      <span class='id identifier rubyid_alternative_exists'>alternative_exists</span> <span class='op'>=</span> <span class='id identifier rubyid_alt_exists'>alt_exists</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
      <span class='comment'># remove alternative if priority is changed and install it with new priority
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_alternative_exists'>alternative_exists</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_alternative_exists_same_prio'>alternative_exists_same_prio</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>removing alternative for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> with old priority</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_alternative_exists'>alternative_exists</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='id identifier rubyid_remove_alt'>remove_alt</span> <span class='op'>=</span> <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --remove </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_remove_alt'>remove_alt</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_remove_alt'>remove_alt</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
          <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>remove alternative failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --remove </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
      <span class='comment'># install the alternative if needed
</span>      <span class='kw'>unless</span> <span class='id identifier rubyid_alternative_exists'>alternative_exists</span>
        <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>adding alternative for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>reset_alternatives</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
          <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rm /var/lib/alternatives/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_install_alt'>install_alt</span> <span class='op'>=</span> <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --install </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bin_path'>bin_path</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_priority'>priority</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_install_alt'>install_alt</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_install_alt'>install_alt</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
          <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>install alternative failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --install </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bin_path'>bin_path</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_priority'>priority</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='comment'># set the alternative if default
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_default'>default</span>
        <span class='id identifier rubyid_set_alt'>set_alt</span> <span class='op'>=</span> <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --display </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> | grep \&quot;link currently points to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
        <span class='rparen'>)</span>
        <span class='id identifier rubyid_set_alt'>set_alt</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
        <span class='kw'>unless</span> <span class='id identifier rubyid_set_alt'>set_alt</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
          <span class='const'>Chef</span><span class='op'>::</span><span class='const'>Log</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>setting alternative for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_set_alt'>set_alt</span> <span class='op'>=</span> <span class='const'>Mixlib</span><span class='op'>::</span><span class='const'>ShellOut</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --set </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_set_alt'>set_alt</span><span class='period'>.</span><span class='id identifier rubyid_run_command'>run_command</span>
          <span class='kw'>unless</span> <span class='id identifier rubyid_set_alt'>set_alt</span><span class='period'>.</span><span class='id identifier rubyid_exitstatus'>exitstatus</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
            <span class='id identifier rubyid_raise'>raise</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>set alternative failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alternatives_cmd'>alternatives_cmd</span><span class='rbrace'>}</span><span class='tstring_content'> --set </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_alt_path'>alt_path</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_bin_cmds'>bin_cmds</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
<span class='comment'># rubocop:enable Style/Next
</span>
<span class='id identifier rubyid_link'>link</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/usr/lib/jvm/default-java</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_java_home'>java_home</span>
  <span class='id identifier rubyid_only_if'>only_if</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_default'>default</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_platform_family?'>platform_family?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>debian</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

    </div>
  
    <div class="method_details ">
      <h3 class="signature"><a name="java_se::_macosx_install">
        <strong>java_se::_macosx_install</strong>
      </a></h3>
      
      

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'java_se/recipes/_macosx_install.rb', line 1</span>

<span class='comment'># inspiration from https://github.com/caskroom/homebrew-cask/blob/master/Casks/java.rb
</span>
<span class='comment'># Note that you may need to stub java_version_on_macosx? method when testing with rspec:
</span><span class='comment'># allow_any_instance_of(Chef::Recipe).to receive(:java_version_on_macosx?).and_return(false)
</span><span class='kw'>unless</span> <span class='id identifier rubyid_java_version_on_macosx?'>java_version_on_macosx?</span>
  <span class='id identifier rubyid_file_cache_path'>file_cache_path</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_java_installer'>fetch_java_installer</span>

  <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='id identifier rubyid_java_version'>java_version</span>

  <span class='id identifier rubyid_name'>name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>JDK </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>release</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> Update </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>update</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hdiutil attach '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file_cache_path'>file_cache_path</span><span class='rbrace'>}</span><span class='tstring_content'>' -quiet</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_avoid_daemon'>avoid_daemon</span> <span class='op'>=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>platform_version</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&gt;=</span> <span class='const'>Gem</span><span class='op'>::</span><span class='const'>Version</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>10.8</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sudo installer -pkg '/Volumes/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>.pkg' -target /</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
    <span class='comment'># Prevent cfprefsd from holding up hdiutil detach for certain disk images
</span>    <span class='id identifier rubyid_environment'>environment</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>__CFPREFERENCES_AVOID_DAEMON</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>1</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_avoid_daemon'>avoid_daemon</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hdiutil detach '/Volumes/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>' || hdiutil detach '/Volumes/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>' -force</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'>#
</span>  <span class='comment'># make minor modifications to the JRE to prevent issues with packaged applications,
</span>  <span class='comment'># as discussed here: https://bugs.eclipse.org/bugs/show_bug.cgi?id=411361
</span>  <span class='comment'>#
</span>
  <span class='qwords_beg'>%w(</span><span class='tstring_content'>BundledApp</span><span class='words_sep'> </span><span class='tstring_content'>JNI</span><span class='words_sep'> </span><span class='tstring_content'>WebStart</span><span class='words_sep'> </span><span class='tstring_content'>Applets</span><span class='words_sep'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_str'>str</span><span class='op'>|</span>
    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/bin/sudo /usr/libexec/PlistBuddy -c \&quot;Add :JavaVM:JVMCapabilities: string </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_str'>str</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; </span><span class='tstring_end'>&quot;</span></span> \
   <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/Library/Java/JavaVirtualMachines/jdk</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='rbrace'>}</span><span class='tstring_content'>.jdk/Contents/Info.plist</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/bin/sudo /bin/ln -nsf /Library/Java/JavaVirtualMachines/jdk</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='rbrace'>}</span><span class='tstring_content'>.jdk/Contents/Home </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/Library/Java/Home</span><span class='tstring_end'>'</span></span>

  <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/usr/bin/sudo /bin/mkdir -p </span><span class='tstring_end'>'</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/Library/Java/JavaVirtualMachines/jdk</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='rbrace'>}</span><span class='tstring_content'>.jdk/Contents/Home/bundle/Libraries</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/bin/sudo /bin/ln -nsf /Library/Java/JavaVirtualMachines/jdk</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='rbrace'>}</span><span class='tstring_content'>.jdk/Contents</span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/Home/jre/lib/server/libjvm.dylib /Library/Java/JavaVirtualMachines/jdk</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='rbrace'>}</span><span class='tstring_content'>.jdk/Contents</span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/Home/bundle/Libraries/libserver.dylib</span><span class='tstring_end'>'</span></span>

  <span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>platform_version</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>.</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&lt;=</span> <span class='int'>9</span> <span class='comment'># mavericks or older
</span>    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/usr/bin/sudo /bin/rm -rf /System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK</span><span class='tstring_end'>'</span></span>

    <span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/bin/sudo /bin/ln -nsf /Library/Java/JavaVirtualMachines/jdk</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_version'>version</span><span class='rbrace'>}</span><span class='tstring_content'>.jdk/Contents </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

    </div>
  
    <div class="method_details ">
      <h3 class="signature"><a name="java_se::_windows_install">
        <strong>java_se::_windows_install</strong>
      </a></h3>
      
      

<table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'java_se/recipes/_windows_install.rb', line 1</span>

<span class='comment'># inspiration from https://chocolatey.org/packages/jdk8
</span><span class='id identifier rubyid_file_cache_path'>file_cache_path</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_java_installer'>fetch_java_installer</span>

<span class='id identifier rubyid_java_home'>java_home</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_home</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='kw'>if</span> <span class='id identifier rubyid_java_home'>java_home</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_java_home'>java_home</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_java_home'>java_home</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_win_install_dir'>win_install_dir</span><span class='rbrace'>}</span><span class='tstring_content'>\\Java\\jdk</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_version'>java_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>else</span>
  <span class='id identifier rubyid_install_dir'>install_dir</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>INSTALLDIR=\&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_win_jre_home'>win_jre_home</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>win_jre_home</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='kw'>if</span> <span class='id identifier rubyid_win_jre_home'>win_jre_home</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_win_jre_home'>win_jre_home</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_win_jre_home'>win_jre_home</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_win_install_dir'>win_install_dir</span><span class='rbrace'>}</span><span class='tstring_content'>\\Java\\jre</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_version'>java_version</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>else</span>
  <span class='id identifier rubyid_jre_install_dir'>jre_install_dir</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/INSTALLDIRPUBJRE=\&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_win_jre_home'>win_jre_home</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>install </span><span class='embexpr_beg'>#{</span><span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_basename'>basename</span><span class='lparen'>(</span><span class='id identifier rubyid_file_cache_path'>file_cache_path</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'> to </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_content'> with JRE </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_win_jre_home'>win_jre_home</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_command'>command</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_file_cache_path'>file_cache_path</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; /s ADDLOCAL=\&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>win_addlocal</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_install_dir'>install_dir</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_jre_install_dir'>jre_install_dir</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_not_if'>not_if</span> <span class='lbrace'>{</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_win_javalink'>win_javalink</span> <span class='op'>=</span> <span class='id identifier rubyid_node'>node</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>java_se</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>win_javalink</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_javalink_dir'>javalink_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_win_javalink'>win_javalink</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='id identifier rubyid_win_javalink'>win_javalink</span><span class='period'>.</span><span class='id identifier rubyid_rindex'>rindex</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>

<span class='comment'># create each directory in win_javalink path except bin (the last path element)
</span><span class='id identifier rubyid_directory'>directory</span> <span class='id identifier rubyid_javalink_dir'>javalink_dir</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_recursive'>recursive</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_not_if'>not_if</span> <span class='lbrace'>{</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_exist?'>exist?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_win_javalink'>win_javalink</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_to'>to</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_content'>\\bin</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_env'>env</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>JAVA_HOME</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_value'>value</span> <span class='id identifier rubyid_java_home'>java_home</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_env'>env</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>JRE_HOME</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_value'>value</span> <span class='id identifier rubyid_win_jre_home'>win_jre_home</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_env'>env</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Add java_se JDK to path</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_key_name'>key_name</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>PATH</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:modify</span>
  <span class='id identifier rubyid_delim'>delim</span> <span class='op'>::</span><span class='const'>File</span><span class='op'>::</span><span class='const'>PATH_SEPARATOR</span>
  <span class='id identifier rubyid_value'>value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_java_home'>java_home</span><span class='rbrace'>}</span><span class='tstring_content'>\\bin</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='comment'># JRE is supposed to come before the JDK on the stock path install. Since chef prepends, JRE env resource comes second.
</span><span class='id identifier rubyid_env'>env</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Add java_se JRE to path</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_key_name'>key_name</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>PATH</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_action'>action</span> <span class='symbol'>:modify</span>
  <span class='id identifier rubyid_delim'>delim</span> <span class='op'>::</span><span class='const'>File</span><span class='op'>::</span><span class='const'>PATH_SEPARATOR</span>
  <span class='id identifier rubyid_value'>value</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_win_jre_home'>win_jre_home</span><span class='rbrace'>}</span><span class='tstring_content'>\\bin</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>

    </div>
  









</div>


</div>
</div>

      <div id="footer">
  Generated on Mon Sep 19 13:01:39 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-1.9.3).
</div>

    </div>
  </body>
</html>